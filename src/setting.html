<!DOCTYPE html>
<html>
<head>
	<title>Setting</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/setting.css">
    <script src="../js/jquery.js"></script>
    <script src="../js/firebase.js"></script>
    <script src="../js/setting.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/spin.js/1.2.7/spin.min.js"></script>
    <script src="../js/log.js"></script>
    <link rel="stylesheet" href="../css/log.css">
    <link rel="stylesheet" href="../css/box.css">
</head>
    
<body>
    <div class="log-box" id="log">     
        <div class="log-message">
            <button type="button" class="log-button" onclick="logout_no()">NO</button>
            <button type="button" class="log-button" onclick="logout_yes()">YES</button>
            <p>Are you sure you want to log out?</p>
        </div>
    </div>
	<section>
        
		<h1>Notification Setting</h1>
        
		<ul id="setting-list">
            
            <!--
        	<li>
				<ul class="setting-info">
            		<li><div class="setting-name">Sleep 8 hours</div></li>
				</ul>
				<ul class="notification">
					<li><div class="notification-type">Turn Off</div><hr></li>						
					<li><div class="notification-type">Pause</div><hr></li>
					<li><div class="notification-type">Sleep</div></li>
				</ul>				
				<div class="onoff">
					<span class="switches">
						<div class="onoffswitch">
							<input type="checkbox" class="onoffswitch-checkbox" id="turnoff-1" name="turnoff">
							<label class="onoffswitch-label"  for="turnoff-1"></label>
						</div>
					</span>
					<span class="switches">
					<div class="onoffswitch">
						<input type="checkbox" class="onoffswitch-checkbox" id="pause-1" name="pause">
						<label class="onoffswitch-label" for="pause-1"></label>
					</div>
					</span>
										
					<span class="switches">
					<div class="onoffswitch">
						<input type="checkbox" class="onoffswitch-checkbox" id="sleep-1" name="sleep">
						<label class="onoffswitch-label" for="sleep-1"></label>
					</div>
					</span>
				</div>
         	</li>
			
			
			<li> 
				<ul class="setting-info">
            		<li><div class="setting-name">Eat Healthy</div></li>
				</ul>
				<ul class="notification">
					<li><div class="notification-type">Turn Off</div><hr></li>						
					<li><div class="notification-type">Pause</div><hr></li>
					<li><div class="notification-type">Sleep</div></li>
				</ul>				
				<div class="onoff">
					<span class="switches">
						<div class="onoffswitch">
							<input type="checkbox" class="onoffswitch-checkbox" id="turnoff-2" name="turnoff">
							<label class="onoffswitch-label" for="turnoff-2"></label>
						</div>
					</span>
					<span class="switches">
					<div class="onoffswitch">
						<input type="checkbox" class="onoffswitch-checkbox" id="pause-2" name="pause">
						<label class="onoffswitch-label" for="pause-2"></label>
					</div>
					</span>
										
					<span class="switches">
					<div class="onoffswitch">
						<input type="checkbox" class="onoffswitch-checkbox" id="sleep-2" name="sleep">
						<label class="onoffswitch-label" for="sleep-2"></label>
					</div>
					</span>
				</div>
				
			</li>
			
			
			
			<li> 
				<ul class="setting-info">
            		<li><div class="setting-name">Exercise 30 minutes</div></li>
				</ul>
				<ul class="notification">
					<li><div class="notification-type">Turn Off</div><hr></li>						
					<li><div class="notification-type">Pause</div><hr></li>
					<li><div class="notification-type">Sleep</div></li>
				</ul>				
				<div class="onoff">
					<span class="switches">
						<div class="onoffswitch">
							<input type="checkbox" class="onoffswitch-checkbox" id="turnoff-3" name="turnoff">
							<label class="onoffswitch-label" for="turnoff-3"></label>
						</div>
					</span>
					<span class="switches">
					<div class="onoffswitch">
						<input type="checkbox" class="onoffswitch-checkbox" id="pause-3" name="pause">
						<label class="onoffswitch-label" for="pause-3"></label>
					</div>
					</span>
										
					<span class="switches">
					<div class="onoffswitch">
						<input type="checkbox" class="onoffswitch-checkbox" id="sleep-3" name="sleep">
						<label class="onoffswitch-label" for="sleep-3"></label>
					</div>
					</span>
				</div>
				
			</li>
			
            -->

			<li> 
				<ul class="setting-info">
            		<li><div class="setting-name">ALL</div></li>
				</ul>
				<ul class="notification">
					<li><div class="notification-type">Turn Off</div><hr></li>						
					<li><div class="notification-type">Pause</div><hr></li>
					<li><div class="notification-type">Sleep</div></li>
				</ul>				
				<div class="onoff">
					<span class="switches">
						<div class="onoffswitch">
							<input type="checkbox" class="onoffswitch-checkbox" id="turnOffAll" onclick="toggleTurnOff(this)" >
							<label class="onoffswitch-label" for="turnOffAll"> </label>
						</div>
					</span>
					<span class="switches">
						<div class="onoffswitch">
							<input type="checkbox" class="onoffswitch-checkbox" id="pauseAll" onclick="togglePause(this)">
							<label class="onoffswitch-label" for="pauseAll"></label>
						</div>
					</span>
										
					<span class="switches">
						<div class="onoffswitch" >
							<input type="checkbox" class="onoffswitch-checkbox" id="sleep3" onclick="toggleSleep(this)">
							<label class="onoffswitch-label" for="sleep3"></label>
						</div>
					</span>
				</div>
			</li>
            
		</ul>
	</section>
    
    <script>
        
        
        function addSettingOptionforHabit(habitKey, name, checked)
        {
            //alert('beginning of append!');
            $('#setting-list').append(
                           
            '<li id=\"' + habitKey + '\">' + 
				'<ul class=\"setting-info\">' +
            		'<li><div class=\"setting-name\">' + name + '</div></li>' +
				'</ul>' +
				'<ul class=\"notification\">' +
					'<li><div class=\"notification-type\">Turn Off</div><hr></li>' +
					'<li><div class=\"notification-type\">Pause</div><hr></li>' +
					'<li><div class=\"notification-type\">Sleep</div></li>' +
				'</ul>' +
				'<div class=\"onoff\">' +
					'<span class=\"switches\">' +
						'<div class=\"onoffswitch\">' +
							'<input type=\"checkbox\" class=\"onoffswitch-checkbox\" id=\"turnoff-'+habitKey+'\" name=\"turnoff\" ' + checked['turnoff'] + '" onclick=\"updateHabitState(this)\">' +
							'<label class=\"onoffswitch-label\" for=\"turnoff-' + habitKey + '\"> </label>' +
						'</div>' +
					'</span>' +
					'<span class=\"switches\">' +
						'<div class=\"onoffswitch\">' +
							'<input type=\"checkbox\" class=\"onoffswitch-checkbox\" id=\"pause-'+habitKey+'\" name=\"pause\" ' + checked['pause'] + ' onclick=\"updateHabitState(this)\">' +
							'<label class=\"onoffswitch-label\" for=\"pause-'+habitKey+'\"></label>' +
						'</div>' +
					'</span>' +
										
					'<span class=\"switches\">' +
						'<div class=\"onoffswitch\" >' +
							'<input type=\"checkbox\" class=\"onoffswitch-checkbox\" id=\"sleep-'+habitKey+'\" name=\"sleep\" ' + checked['sleep'] + ' onclick=\"updateHabitState(this)\">' +
							'<label class=\"onoffswitch-label\" for=\"sleep-'+habitKey+'\"></label>' +
						'</div>' +
					'</span>' +
				'</div>' +
			'</li>'              
            );   
            
            //alert('End of append.');
        }
        
        function updateHabitState(element)
        {
            //alert();
            var habitData = $(element).prop('id');
            var array = habitData.split('-');
            var statusStateName = array[0];
            
            var habitDataRef = refData.child('-' + array[2] +'/habitData/settings/');
            
            var statusStateVal;
            if($(element).prop("checked") == true)
            {
                statusStateVal = '1';
            }
            else
            {
                statusStateVal = '0';    
            }
            
            if(statusStateName.localeCompare('sleep') == 0)
            {
                habitDataRef.update({sleep: statusStateVal});
            }
            else if (statusStateName.localeCompare('pause') == 0)
            {
                habitDataRef.update({pause: statusStateVal});
            }
            else if (statusStateName === 'turnoff')
            {
                habitDataRef.update({turnoff: statusStateVal});
            }    
        }
        
        $(document).ready(function() 
        {
            //alert('Beginnign of script.');
           
            refData.on('child_added', function(snapshot){
                //alert('added called.');
                var data = snapshot.val().habitData;
                var habitKey = snapshot.name();
                
                if(data.hasOwnProperty('name')){
                    name = data.name ? data.name : '';
                    if(name.trim().length > 0)
                        {
                            habitSettingList.push({key: habitKey, name: name});
                            habitSettingObject[habitKey] = name;
                        }
                }
                
                var stateChecker = {};
                for(var k in data.settings)
                {
                    if(data.settings[k] === '0')
                        {
                            stateChecker[k] = "";
                        }
                    else
                        {
                            stateChecker[k] = "checked";
                        }
                }
                //alert(JSON.stringify(stateChecker));
                
                addSettingOptionforHabit(habitKey, name, stateChecker);
                //alert('Child added.');
            });
        });
        
    </script>
    <div id="button-box">
        <button type="button" id="logout" onclick="logout_called()">LOGOUT</button>
    </div> 
    <hr style="height:100px;border-width:0">
</body>
</html>